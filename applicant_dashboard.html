<html>

<head>
  <title>safeGather</title>
  <!-- CSS -->
  <!-- CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
    integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <!-- Material Design Bootstrap -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/css/mdb.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@10.10.0/dist/sweetalert2.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700&display=swap" rel="stylesheet">
  <link rel='stylesheet' type='text/css' href='https://api.tomtom.com/maps-sdk-for-web/cdn/5.x/5.39.0/maps/maps.css'>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <nav class="row navbar navbar-expand-md navbar-light bg-white sticky-top shadow-none">
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <div class="col-lg-5 col-md-2">
        <a class="navbar-brand ml-4" style="font-family:Helvetica Neue;color:#00c851;font-size: 1.5rem;"
          href="#">safeGather</a>
      </div>
      <div class="col-lg-5 col-md-7">

      </div>
      <div class="col-lg-2 col-md-3">
        <div class="float-right mr-3 not-logged-in-wrapper">
          <a class="btn btn-success mr-2" href="help.html" target="_blank">Help</a>
          <a class="btn btn-outline-white" onclick="showLoginRegisterForm()">Login</a>
        </div>
        <div class="float-right mr-3 logged-in-wrapper">
          <div class="mr-4 logged-in-name"
            style="font-family: 'Montserrat';font-size: 1rem;color: gray !important;margin: .375rem;text-align: center;">
            Hi, Needy</div>
          <a class="btn btn-outline-dark" onclick="loggout()">Logout</a>
        </div>
      </div>

      <!-- Sidebar elements moved to navbar when collapsed -->
      <ul class="nav mt-3 flex-column d-md-none d-lg-none">
        <li class="nav-item">
          <a class="nav-link text-success" href="./applicant_dashboard.html">
            <i class="mdi mdi-settings menu-icon"></i>
            <span class="menu-title">Event Registration</span>
          </a>
        </li>
      </ul>

    </div>
  </nav>

  <div class="row h-100">
    <!-- Sidenav -->
    <div class="col-md-2 col-lg-2 d-none d-md-block d-lg-block position-fixed h-100 bg-white" id="sidebar">
      <ul class="nav mt-3 flex-column">
        <li class="nav-item">
          <a class="nav-link text-success" href="./applicant_dashboard.html">
            <i class="mdi mdi-settings menu-icon"></i>
            <span class="menu-title">Event Registration</span>
          </a>
        </li>
      </ul>
    </div>

    <!-- Main content -->
    <div class="col-md-10 col-lg-10 offset-md-2">
      <!-- Table -->
      <h3 class="card-title py-2  mt-4">My events</h3>
      <div class="row pb-4">
        <div class="table-wrapper-scroll-y my-custom-scrollbar w-100 px-2">
          <table class="table table-bordered table-striped mb-0">
            <thead>
              <tr class="text-muted">
                <th scope="col" style="width: 6%;">Event ID</th>
                <th scope="col" style="width: 10%;">Event type</th>
                <th scope="col" style="width: 10%;">Event Start Date & Time</th>
                <th scope="col" style="width: 10%;">Event End Date & Time</th>
                <th scope="col" style="width: 15%;">Location</th>
                <th scope="col" style="width: 5%;">Number of Personnel (Organizer)</th>
                <th scope="col" style="width: 10%;">Maximum Number of Participants</th>
                <th scope="col" style="width: 10%;">Current Number of Participants</th>
                <th scope="col" style="width: 30%;">Action</th>
              </tr>
            </thead>
            <tbody id="myevent-table-body">

            </tbody>
          </table>
        </div>
      </div>
      <!-- End of Table -->

      <!-- Table -->
      <h3 class="card-title py-2  mt-4">Today's events</h3>
      <div class="row pb-4">
        <div class="table-wrapper-scroll-y my-custom-scrollbar w-100 px-2">
          <table class="table table-bordered table-striped mb-0">
            <thead>
              <tr class="text-muted">
                <th scope="col" style="width: 6%;">Event ID</th>
                <th scope="col" style="width: 10%;">Event type</th>
                <th scope="col" style="width: 10%;">Event Start Date & Time</th>
                <th scope="col" style="width: 10%;">Event End Date & Time</th>
                <th scope="col" style="width: 15%;">Location</th>
                <th scope="col" style="width: 5%;">Number of Personnel (Organizer)</th>
                <th scope="col" style="width: 10%;">Maximum Number of Participants</th>
                <th scope="col" style="width: 10%;">Current Number of Participants</th>
                <th scope="col" style="width: 30%;">Action</th>
              </tr>
            </thead>
            <tbody id="today-table-body">

            </tbody>
          </table>
        </div>
      </div>
      <!-- End of Table -->

      <!-- Table -->
      <h3 class="card-title py-2  mt-4">Upcoming events (Open for Registration)</h3>
      <div class="row pb-4">
        <div class="table-wrapper-scroll-y my-custom-scrollbar w-100 px-2">
          <table class="table table-bordered table-striped mb-0">
            <thead>
              <tr class="text-muted">
                <th scope="col" style="width: 6%;">Event ID</th>
                <th scope="col" style="width: 10%;">Event type</th>
                <th scope="col" style="width: 8%;">Event Start Date & Time</th>
                <th scope="col" style="width: 8%;">Event End Date & Time</th>
                <th scope="col" style="width: 15%;">Location</th>
                <th scope="col" style="width: 5%;">Number of Personnel (Organizer)</th>
                <th scope="col" style="width: 10%;">Maximum Number of Participants</th>
                <th scope="col" style="width: 8%;">Current Number of Participants</th>
                <th scope="col" style="width: 30%;">Action</th>
              </tr>
            </thead>
            <tbody id="upcoming-table-body">

            </tbody>
          </table>
        </div>
      </div>
      <!-- End of Table -->
    </div>
    <!-- end of main content -->
  </div>

  <!-- Start of modal -->
  <div class="modal fade" id="itemModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header" style="border: 0;">
          <h5 class="modal-title" id="exampleModalLabel">Distribution Info</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form>
            <div class="form-row">
              <div class="form-group col-md-12">
                <label>Event Request Id</label>
                <span class="form-control" id="modal-request-id">asfsd23asf</span>
              </div>
              <div class="form-group col-md-12">
                <label>Event Type</label>
                <span class="form-control" id="modal-distribution-type">asfsd23asf</span>
              </div>
              <div class="form-group col-md-6">
                <label>Event Start Date & Time</label>
                <span class="form-control" id="modal-distribution-start-datetime">4/11/2020</span>
              </div>
              <div class="form-group col-md-6">
                <label for="inputPassword4">Event End Date & Time</label>
                <span class="form-control" id="modal-distribution-end-datetime">4/11/2020</span>
              </div>
              <div class="form-group col-md-12">
                <label>Distribution Items</label>
                <span class="form-control" id="modal-distribution-items">asfsd23asf</span>
              </div>
              <div class="form-group col-md-6">
                <label for="inputPassword4">Number Of Personnel</label>
                <span class="form-control" id="modal-num-of-personnel">4/11/2020</span>
              </div>
              <div class="form-group col-md-6">
                <label for="inputPassword4">Maximum Number Of Applicants</label>
                <span class="form-control" id="modal-maximum-num-of-applicant">4/11/2020</span>
              </div>
              <div class="form-group col-md-12">
                <label>Remarks</label>
                <span class="form-control" id="modal-remark">asfsd23asf</span>
              </div>
              <div id="modal-doorstep-distribution-info-wrapper" class="form-group col-md-12">
                <label>Doorstep Distribution Area</label>
                <span class="form-control" id="modal-doorstep-distribution-area">asfsd23asf</span>
              </div>
              <div id="modal-centralised-distribution-info-wrapper" class="form-group col-md-12">
                <label>Centralised Distribution Point Address</label>
                <span class="form-control" id="modal-location">asfsd23asf</span>
                <div id="map-location-wrapper"></div>
              </div>

            </div>
          </form>
        </div>
        <div class="modal-footer" style="border: 0;">
          <button type="button" class="btn btn-danger" data-dismiss="modal" style="width: 150px;">Close</button>
        </div>
      </div>
    </div>
  </div>
  <!-- End of modal -->

  <!-- jQuery library -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!-- Popper JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>
  <!-- Latest compiled JavaScript -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
    crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
  <!-- MDB core JavaScript -->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/js/mdb.min.js"></script>

  <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/8.0.1/firebase-app.js"></script>

  <!-- If you enabled Analytics in your project, add the Firebase SDK for Analytics -->
  <script src="https://www.gstatic.com/firebasejs/8.0.1/firebase-analytics.js"></script>

  <!-- Add Firebase products that you want to use -->
  <script src="https://www.gstatic.com/firebasejs/8.0.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.0.1/firebase-firestore.js"></script>


  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10.10.0/dist/sweetalert2.min.js"></script>
  <script src="https://api.tomtom.com/maps-sdk-for-web/cdn/5.x/5.39.0/maps/maps-web.min.js"></script>
  <script src="https://api.tomtom.com/maps-sdk-for-web/cdn/5.x/5.39.0/services/services-web.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

  <script type="text/javascript" src="firebase.js"></script>
  <script type="text/javascript" src="loginHandler.js"></script>
  <script type="text/javascript" src="index.js"></script>
  <script>
    var myEventDistributionData = [];
    var todayDistributionData = [];
    var upcomingDistributionData = [];
    
    function fetchAllDistribution() {
      db.collection("mco_requests")
        .where('status', '==', 'accepted')
        .onSnapshot(function (querySnapshot) {
          //today means startDate is today and is not started yet
          var myEventDistributionDocument = querySnapshot.docs.filter((document) => {
            var applicants = document.data().applicants;
            var myId = firebase.auth().currentUser.uid;
            var isMyEvent = false;

            if(applicants !== undefined){
              applicants.map(applicantData=>{
                if(applicantData.userId !== undefined && applicantData.userId === myId){
                  isMyEvent = true;
                }
              })
            }
            
            return isMyEvent;
          });

          //today means startDate is today and is not started yet
          var todayDistributionDocument = querySnapshot.docs.filter((document) => {
            var startDateTime = moment(document.data().distributionStartDateTime.toDate())

            //check if the event already enrolled by current account 
            //show only if havent enrolled
            var applicants = document.data().applicants;
            var myId = firebase.auth().currentUser.uid;
            var isMyEvent = false;

            if(applicants !== undefined){
              applicants.map(applicantData=>{
                if(applicantData.userId !== undefined && applicantData.userId === myId){
                  isMyEvent = true;
                }
              })
            }

            return startDateTime.isSame(moment().startOf('day'), 'day') && moment().isBefore(startDateTime) && isMyEvent === false;
          });

          //upcoming means after the event startdateTime and the event is not end yet
          var upcomingDistributionDocument = querySnapshot.docs.filter((document) => {
            var startDateTime = moment(document.data().distributionStartDateTime.toDate())
            var endDateTime = moment(document.data().distributionEndDateTime.toDate())

            //check if the event already enrolled by current account 
            //show only if havent enrolled
            var applicants = document.data().applicants;
            var myId = firebase.auth().currentUser.uid;
            var isMyEvent = false;

            if(applicants !== undefined){
              applicants.map(applicantData=>{
                if(applicantData.userId !== undefined && applicantData.userId === myId){
                  isMyEvent = true;
                }
              })
            }


            return startDateTime.isAfter(moment().endOf('day')) && isMyEvent === false;
          });


          $("#myevent-table-body").empty();  
          $("#today-table-body").empty();
          $("#upcoming-table-body").empty();  


          if (myEventDistributionDocument.length <= 0) {
            $("#myevent-table-body").append(`<td class="text-center" colspan="9">You have no registered event yet</td>`)
          }
          if (todayDistributionDocument.length <= 0) {
            $("#today-table-body").append(`<td class="text-center" colspan="9">There are no event Today</td>`)
          }
          if (upcomingDistributionDocument.length <= 0) {
            $("#upcoming-table-body").append(`<td class="text-center" colspan="9">There are no upcoming event after today</td>`)
          }

          myEventDistributionDocument.forEach(function (document) {
            const doc = document.data()

            var arrayIndex = myEventDistributionData.length

            myEventDistributionData.push({
              id: document.id,
              ...doc
            })

            $("#myevent-table-body").append(`
                                <tr class="text-muted">
                                    <td scope="row">${doc.id}</th>
                                    <th scope="row">${doc.distributionType}</th>
                                    <td>${moment(doc.distributionStartDateTime.toDate()).format('DD-MM-YYYY hh:mm A')}</td>
                                    <td>${moment(doc.distributionEndDateTime.toDate()).format('DD-MM-YYYY hh:mm A')}</td>
                                    <td>${doc.locationName || doc.doorstepDistributionArea}</td>
                                    <td>${doc.numOfPersonnel}</td>
                                    <td>${doc.numOfNeedy}</td>
                                    <td>${doc.applicants ? doc.applicants.length : 0}</td>
                                    <td>
                                        <div class="row d-flex justify-content-between mx-2">
                                            <a class="btn btn-primary text-light col-md-3" onclick="showInfo(${arrayIndex}, 'myevent')" >Info</a>
                                            <div class="col-md-8 d-flex">
                                              <span class="btn btn-danger text-light w-100 mx-2" onclick="unRegisterApplicantModal('${document.id}')">Unenroll</span>                              
                                          </div>
                                        </div>
                                    </td>
                                </tr>
                                    `
            )



          });

          todayDistributionDocument.forEach(function (document) {
            const doc = document.data()

            var arrayIndex = todayDistributionData.length

            todayDistributionData.push({
              id: document.id,
              ...doc
            })

            $("#today-table-body").append(`
                                <tr class="text-muted">
                                    <td scope="row">${doc.id}</th>
                                    <th scope="row">${doc.distributionType}</th>
                                    <td>${moment(doc.distributionStartDateTime.toDate()).format('DD-MM-YYYY hh:mm A')}</td>
                                    <td>${moment(doc.distributionEndDateTime.toDate()).format('DD-MM-YYYY hh:mm A')}</td>
                                    <td>${doc.locationName || doc.doorstepDistributionArea}</td>
                                    <td>${doc.numOfPersonnel}</td>
                                    <td>${doc.numOfNeedy}</td>
                                    <td>${doc.applicants ? doc.applicants.length : 0}</td>
                                    <td>
                                        <div class="row d-flex justify-content-between mx-2">
                                            <a class="btn btn-primary text-light col-md-3" onclick="showInfo(${arrayIndex}, 'today')" >Info</a>

                                        </div>
                                    </td>
                                </tr>
                                    `
            )



          });

          upcomingDistributionDocument.forEach(function (document) {
            const doc = document.data()
            console.log(doc)

            var arrayIndex = upcomingDistributionData.length

            upcomingDistributionData.push({
              id: document.id,
              ...doc
            })
            var shouldAllowRegister = ""

            if (!doc.applicants) {
              shouldAllowRegister = `<div class="col-md-8 d-flex">
                                          <a class="btn btn-success text-light w-100 mx-2" onclick="registerApplicantModal('${document.id}')">Register Applicant</a>                              
                                      </div>`

            }

            if (!!doc.applicants && doc.applicants.length < doc.numOfNeedy) {
              shouldAllowRegister = `<div class="col-md-8 d-flex">
                                          <a class="btn btn-success text-light w-100 mx-2" onclick="registerApplicantModal('${document.id}')">Register Applicant</a>                              
                                      </div>`
            }

            if (!!doc.applicants && doc.applicants.length >= doc.numOfNeedy) {
              shouldAllowRegister = `<div class="col-md-8 d-flex">
                                          <span class="btn btn-danger text-light w-100 mx-2" style="pointer-events:none !important">Fully Registered</span>                              
                                      </div>`
            }

            $("#upcoming-table-body").append(`
                                <tr class="text-muted">
                                    <td scope="row">${doc.eventId}</th>
                                    <th scope="row">${doc.distributionType}</th>
                                    <td>${moment(doc.distributionStartDateTime.toDate()).format('DD-MM-YYYY hh:mm A')}</td>
                                    <td>${moment(doc.distributionEndDateTime.toDate()).format('DD-MM-YYYY hh:mm A')}</td>
                                    <td>${doc.locationName || doc.doorstepDistributionArea}</td>
                                    <td>${doc.numOfPersonnel}</td>
                                    <td>${doc.numOfNeedy}</td>
                                    <td>${doc.applicants ? doc.applicants.length : 0}</td>
                                    <td>
                                        <div class="row d-flex justify-content-between mx-2">
                                            <a class="btn btn-primary text-light col-md-3" onclick="showInfo(${arrayIndex}, 'upcoming')" >Info</a>
                                            ${shouldAllowRegister
              }
                                        </div>
                                    </td>
                                </tr>
                                    `
            )



          });


        });
    }

    function showInfo(requestIndex, type) {
      var currentReqestInfo = null;

      switch (type) {
        case "myevent":
          currentReqestInfo = myEventDistributionData[requestIndex];
          break;
        case "today":
          currentReqestInfo = todayDistributionData[requestIndex];
          break;
        case "upcoming":
          currentReqestInfo = upcomingDistributionData[requestIndex];
          break;
        case "ongoing":
          currentReqestInfo = ongoingDistributionData[requestIndex];
          break;
        case "done":
          currentReqestInfo = doneDistributionData[requestIndex];
          break;

      }


      $("#modal-request-id").html(currentReqestInfo.id);
      $("#modal-distribution-type").html(currentReqestInfo.distributionType);
      $("#modal-distribution-start-datetime").html(moment(currentReqestInfo.distributionStartDateTime.toDate()).format('DD-MM-YYYY hh:mm A'));
      $("#modal-distribution-end-datetime").html(moment(currentReqestInfo.distributionEndDateTime.toDate()).format('DD-MM-YYYY hh:mm A'));
      $("#modal-distribution-items").html(currentReqestInfo.distributionItems);
      $("#modal-num-of-personnel").html(currentReqestInfo.numOfPersonnel);
      $("#modal-maximum-num-of-applicant").html(currentReqestInfo.numOfNeedy);
      $("#modal-remark").html(currentReqestInfo.remark);
      $("#modal-request-id").html(currentReqestInfo.id);

      if (currentReqestInfo.distributionType == "centralised-distribution") {
        $("#modal-doorstep-distribution-info-wrapper").css("display", "none");
        $("#modal-centralised-distribution-info-wrapper").css("display", "block");

        $("#modal-location").html(currentReqestInfo.locationName);
        //TomTom map initialization
        setTimeout(() => {
          const apiKey = 'pDnGSI4YJIaGwPmkmQNZjLIG02H6rxB2';
          var map = tt.map({
            key: apiKey,
            container: 'map-location-wrapper',
            center: [currentReqestInfo.locationCoor.longitude, currentReqestInfo.locationCoor.latitude],
            style: 'tomtom://vector/1/basic-main',
            zoom: 12
          });
          var marker = new tt.Marker({ color: "red" }).setLngLat([currentReqestInfo.locationCoor.longitude, currentReqestInfo.locationCoor.latitude]).addTo(map);
        }, 500);

      } else {
        $("#modal-doorstep-distribution-info-wrapper").css("display", "block");
        $("#modal-centralised-distribution-info-wrapper").css("display", "none");

        $("#modal-doorstep-distribution-area").html(currentReqestInfo.doorstepDistributionArea);


      }



      $('#itemModal').modal('show');


    }

    function registerApplicantModal(documentId) {
      Swal.fire({
        title: 'Are you sure you want to enroll for the event?',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes, enroll!'
      }).then((result) => {
        if (result.isConfirmed) {
          Swal.fire({
            title: 'We are processing your request',
            timerProgressBar: true,
            showConfirmButton: false,
            willOpen: () => {
              Swal.showLoading()
            },
            willClose: () => {
            }
          });

          var myId = firebase.auth().currentUser.uid;
          db.collection("users").doc(myId).get().then(async (doc)=>{
            var userData = doc.data();

            var applicantObj = {
              userId: doc.id,
              ic: userData.ic || '',
              name: userData.name,
              phone: userData.phone || '',
              address: userData.addressName || ''
            }

            var mcoRequest = await db.collection("mco_requests").doc(documentId).get().then((d) => { return d });
            var mcoRequestData = mcoRequest.data();
            console.log(mcoRequestData);

            var applicants = mcoRequestData.applicants


            if (!!applicants) {
              applicants.push(applicantObj);
            } else {
              applicants = [];
              applicants.push(applicantObj);
            }

            console.log(applicants);

            db.collection("mco_requests").doc(documentId).update({
              applicants: applicants
            })
            .then(function () {
              Swal.close();
              Swal.fire(
                'You have successfully enrolled',
                'You are now registered to the event. please print the ticket as an evidence for the applicant',
                'success'
              ).then((res) => {
                var tab = window.open('Applicant Ticket', '_blank');
                tab.document.write(`
                    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
                    <body>
                      <div class="container text-center">
                        <img src="resources/qrcode-sample.png" width="300" height="300"/>
                        <h3>This is a computer generated offical ticket that certified that the applicant below:</h3>  
                        <p>
                          The applicant info are as below <br>
                          <span class="font-weight-bold">Applicant Name:</span> ${applicantObj.value.name}  <br>
                          <span class="font-weight-bold">Applicant ic:</span> ${applicantObj.value.ic}  <br>
                          <span class="font-weight-bold">Applicant contact:</span> ${applicantObj.value.phone}  <br>
                          <span class="font-weight-bold">Applicant address:</span> ${applicantObj.value.address}  <br>
                          <hr/>
                          The event infomation are as below: <br>
                          <span class="font-weight-bold">Event ID:</span> ${mcoRequest.id}  <br>
                          <span class="font-weight-bold">Event Type:</span> ${mcoRequestData.distributionType}  <br>
                          <span class="font-weight-bold">Event StartDateTime:</span> ${moment(mcoRequestData.distributionStartDateTime.toDate()).format('DD-MM-YYYY hh:mm A')}  <br>
                          <span class="font-weight-bold">Event End DateTime:</span> ${moment(mcoRequestData.distributionEndDateTime.toDate()).format('DD-MM-YYYY hh:mm A')}  <br>
                          <span class="font-weight-bold">Event Location:</span> ${mcoRequestData.locationName || mcoRequestData.doorstepDistributionArea}  <br>
                          <span class="font-weight-bold">Event Distributions Items:</span> ${mcoRequestData.distributionItems}  <br>
                        </p>
                        
                      </div>
                    </body>
                
                `); // where 'html' is a variable containing your HTML
                tab.document.close(); // to finish loading the page
              })

            })
            .catch(function (error) {
              console.error("Error writing document: ", error);
            });
          });
        }
      })
    }

    function unRegisterApplicantModal(documentId) {
      Swal.fire({
        title: 'Are you sure you want to unenroll for the event?',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes, unEnroll!'
      }).then(async (result) => {
        if (result.isConfirmed) {
          Swal.fire({
            title: 'We are processing your request',
            timerProgressBar: true,
            showConfirmButton: false,
            willOpen: () => {
              Swal.showLoading()
            },
          });

          console.log(documentId);
          
          var myId = firebase.auth().currentUser.uid;
          var mcoRequest = await db.collection("mco_requests").doc(documentId).get().then((d) => { return d });
          var mcoRequestData = mcoRequest.data();
          console.log(mcoRequestData);

          var applicants = mcoRequestData.applicants

          newApplicant = applicants.filter((applicantData)=>{
            return applicantData.userId !== undefined && applicantData.userId !== myId;
          })

          db.collection("mco_requests").doc(documentId).update({
            applicants: newApplicant
          })
          .then(function () {
            Swal.close();
            Swal.fire(
              'The Successfully unregistered',
              'You have unenrolled from the event.',
              'success'
            )
          })
          .catch(function (error) {
            console.error("Error writing document: ", error);
          });
        }
      })
    }

    fetchAllDistribution();
  </script>

</body>

</html>